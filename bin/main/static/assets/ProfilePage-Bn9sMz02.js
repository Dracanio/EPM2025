import{d as Z,u as q,a as H,r as i,w as J,c as Q,b as o,e as W,f as e,A as X,t as u,g as Y,h as m,v,i as N,F as j,j as S,k as ee,o as n,l as te,_ as se}from "./index-BrXUwsKC.js";const le={class:"profile-shell min-vh-100"},ae={class:"container-fluid px-3 px-lg-4 py-4"},oe={class:"row g-4"},ne={class:"col-12 col-xl-6"},ie={class:"card border-0 shadow-sm h-100"},re={class:"card-body"},ce={class:"d-flex align-items-center gap-3 mb-3"},de={class:"profile-avatar"},ue=["src"],me={key:1},ve={class:"btn btn-outline-secondary btn-sm mb-0"},pe={class:"vstack gap-2"},be={class:"mt-3 d-flex align-items-center gap-2"},fe={key:0,class:"small text-success"},he={class:"col-12 col-xl-6"},_e={class:"card border-0 shadow-sm h-100"},ge={class:"card-body"},ye={class:"row g-2 mb-3"},ke={class:"col-12"},xe={class:"col-12"},Te={class:"col-12"},we={key:0,class:"col-12"},Pe={class:"small text-danger mb-0"},Ce={class:"vstack gap-2"},Ue={key:0,class:"small text-secondary"},Ee={key:0,class:"vstack gap-2"},Ne={class:"d-flex gap-2"},je=["onClick"],Ve={class:"fw-semibold mb-0"},Ae={class:"small text-secondary mb-0"},Ie={class:"d-flex align-items-center justify-content-between gap-2 mt-1"},Me={class:"small mb-0"},Le={class:"d-flex gap-1"},Se=["onClick"],Be=["onClick"],De={class:"card border-0 shadow-sm mt-4"},Fe={class:"card-body"},$e={key:0,class:"small text-secondary"},ze={key:1,class:"row g-3"},Oe={class:"project-access-card"},Re={class:"fw-semibold mb-1"},Ge={class:"small text-secondary mb-1"},Ke={class:"small text-secondary mb-1"},Ze={class:"small text-secondary mb-0"},qe=Z({__name:"ProfilePage",setup(He){var I,M,L;const r=q(),B=H(),y=i(((I=r.user)==null?void 0:I.name)||""),C=i(((M=r.user)==null?void 0:M.email)||""),k=i(((L=r.user)==null?void 0:L.avatarUrl)||""),U=i(!1),x=i(""),T=i(""),w=i(""),b=i(""),c=i([]),P=i(null),f=i(""),h=i(""),_=i("");J(()=>{var l,t;return[(l=r.user)==null?void 0:l.id,(t=r.user)==null?void 0:t.email]},()=>{var t,s;const l=(t=r.user)==null?void 0:t.id;if(!l){c.value=[];return}c.value=te(l,((s=r.user)==null?void 0:s.email)||void 0)},{immediate:!0});const V=Q(()=>{var t,s;const l=(s=(t=r.user)==null?void 0:t.email)==null?void 0:s.trim().toLowerCase();return l?Object.values(B.byProjectId).filter(a=>a.members.some(d=>d.email.trim().toLowerCase()===l)||a.teamAccesses.some(d=>d.memberEmails.includes(l))):[]});function E(){var t;const l=(t=r.user)==null?void 0:t.id;l&&ee(l,c.value)}function A(l){var a,d;const t=l.split(",").map(p=>p.trim().toLowerCase()).filter((p, G, K)=>p.length>0&&K.indexOf(p)===G);if(t.length>0)return t;const s=(d=(a=r.user)==null?void 0:a.email)==null?void 0:d.trim().toLowerCase();return s?[s]:[]}function D(){r.updateProfile({name:y.value.trim(),email:C.value.trim().toLowerCase(),avatarUrl:k.value||void 0}),U.value=!0,setTimeout(()=>{U.value=!1},1400)}function F(l){const t=l.target;if(!t.files||!t.files[0])return;const s=t.files[0],a=new FileReader;a.onload= d=>{var p;k.value=((p=d.target)==null?void 0:p.result)||""},a.readAsDataURL(s),t.value=""}function $(){const l=x.value.trim();if(!l){b.value="Teamname ist erforderlich.";return}b.value="",c.value.unshift({id:crypto.randomUUID(),name:l,description:T.value.trim(),memberEmails:A(w.value)}),x.value="",T.value="",w.value="",E()}function z(l){P.value=l.id,f.value=l.name,h.value=l.description,_.value=l.memberEmails.join(", "),b.value=""}function g(){P.value=null,f.value="",h.value="",_.value=""}function O(l){const t=f.value.trim();if(!t){b.value="Teamname ist erforderlich.";return}const s=c.value.findIndex(d=>d.id===l);if(s===-1){g();return}const a=c.value[s];if(!a){g();return}c.value[s]={...a,name:t,description:h.value.trim(),memberEmails:A(_.value)},E(),g()}function R(l){window.confirm(`Team "${l.name}" wirklich loeschen?`)&&(c.value=c.value.filter(s=>s.id!==l.id),E(),P.value===l.id&&g())}return(l, t)=>(n(),o("div",le,[W(X,{"active-section":"projects","context-label":"Profil"}),e("main",ae,[e("div",oe,[e("div",ne,[e("section",ie,[e("div",re,[t[11]||(t[11]=e("h1",{class:"h4 mb-2"},"Profil",-1)),t[12]||(t[12]=e("p",{class:"text-secondary mb-3"},"Persoenliche Daten und Profilbild verwalten.",-1)),e("div",ce,[e("div",de,[k.value?(n(),o("img",{key:0,src:k.value,alt:"Avatar"},null,8,ue)):(n(),o("span",me,u((y.value||"U").slice(0,1).toUpperCase()),1))]),e("div",null,[e("label",ve,[t[8]||(t[8]=Y(" Profilbild hochladen ",-1)),e("input",{type:"file",class:"d-none",accept:"image/*",onChange:F},null,32)])])]),e("div",pe,[e("div",null,[t[9]||(t[9]=e("label",{class:"form-label"},"Name",-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]= s=>y.value=s),type:"text",class:"form-control"},null,512),[[v,y.value]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"form-label"},"E-Mail",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]= s=>C.value=s),type:"email",class:"form-control"},null,512),[[v,C.value]])])]),e("div",be,[e("button",{type:"button",class:"btn btn-primary",onClick:D},"Profil speichern"),U.value?(n(),o("span",fe,"Gespeichert")):N("",!0)])])])]),e("div",he,[e("section",_e,[e("div",ge,[t[13]||(t[13]=e("h2",{class:"h5 mb-2"},"Teams",-1)),t[14]||(t[14]=e("p",{class:"text-secondary mb-3"},"Neue Teams erstellen und spaeter mit Projekten verknuepfen.",-1)),e("div",ye,[e("div",ke,[m(e("input",{"onUpdate:modelValue":t[2]||(t[2]= s=>x.value=s),type:"text",class:"form-control",placeholder:"Teamname"},null,512),[[v,x.value]])]),e("div",xe,[m(e("input",{"onUpdate:modelValue":t[3]||(t[3]= s=>T.value=s),type:"text",class:"form-control",placeholder:"Beschreibung (optional)"},null,512),[[v,T.value]])]),e("div",Te,[m(e("input",{"onUpdate:modelValue":t[4]||(t[4]= s=>w.value=s),type:"text",class:"form-control",placeholder:"Mitglieder E-Mails (kommagetrennt)"},null,512),[[v,w.value]])]),e("div",{class:"col-12"},[e("button",{type:"button",class:"btn btn-outline-primary w-100",onClick:$},"Team erstellen")]),b.value?(n(),o("div",we,[e("p",Pe,u(b.value),1)])):N("",!0)]),e("div",Ce,[c.value.length===0?(n(),o("div",Ue,"Noch keine Teams erstellt.")):N("",!0),(n(!0),o(j,null,S(c.value, s=>(n(),o("article",{key:s.id,class:"team-row"},[P.value===s.id?(n(),o("div",Ee,[m(e("input",{"onUpdate:modelValue":t[5]||(t[5]= a=>f.value=a),type:"text",class:"form-control form-control-sm",placeholder:"Teamname"},null,512),[[v,f.value]]),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]= a=>h.value=a),type:"text",class:"form-control form-control-sm",placeholder:"Beschreibung (optional)"},null,512),[[v,h.value]]),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]= a=>_.value=a),type:"text",class:"form-control form-control-sm",placeholder:"Mitglieder E-Mails (kommagetrennt)"},null,512),[[v,_.value]]),e("div",Ne,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick: a=>O(s.id)},"Speichern",8,je),e("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:g},"Abbrechen")])])):(n(),o(j,{key:1},[e("p",Ve,u(s.name),1),e("p",Ae,u(s.description||"Ohne Beschreibung"),1),e("div",Ie,[e("p",Me,u(s.memberEmails.length)+" Mitglied(er)",1),e("div",Le,[e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick: a=>z(s)},"Bearbeiten",8,Se),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick: a=>R(s)},"Loeschen",8,Be)])])],64))]))),128))])])])])]),e("section",De,[e("div",Fe,[t[15]||(t[15]=e("h2",{class:"h5 mb-2"},"Team-Zugriffe in Projekten",-1)),t[16]||(t[16]=e("p",{class:"text-secondary mb-3"},"Uebersicht der Projekte, in denen dein Account Mitglied ist.",-1)),V.value.length===0?(n(),o("div",$e,"Keine zugewiesenen Projektzugriffe vorhanden.")):(n(),o("div",ze,[(n(!0),o(j,null,S(V.value, s=>(n(),o("div",{key:s.projectId,class:"col-12 col-md-6 col-xl-4"},[e("article",Oe,[e("p",Re,"Projekt "+u(s.projectId.slice(0,8)),1),e("p",Ge,u(s.members.length)+" Teammitglieder",1),e("p",Ke,u(s.teamAccesses.length)+" Projekt-Teams",1),e("p",Ze,u(s.shareLinks.length)+" Share-Links",1)])]))),128))]))])])])]))}}),Qe=se(qe,[["__scopeId","data-v-79a422bd"]]);export{Qe as default};
